square_seq = [40 40 40 5 0.066; 60 60 60 5 0.233; 80 80 80 5 0.334; 100 100 100 5 0.637; 120 120 120 5 1.189; 140 140 140 5 1.569; 160 160 160 5 2.212; 180 180 180 5 3.196; 200 200 200 5 4.079; 220 220 220 5 5.557; 240 240 240 5 6.865; 260 260 260 5 8.7; 280 280 280 5 10.182; 300 300 300 5 12.678; 320 320 320 5 14.741; 340 340 340 5 17.945; 360 360 360 5 20.741; 380 380 380 5 24.75; 400 400 400 5 28.125; 420 420 420 5 33.05; 440 440 440 5 37.376; 460 460 460 5 43.637; 480 480 480 5 48.62; 500 500 500 5 55.949; 520 520 520 5 62.997; 540 540 540 5 70.636; 560 560 560 5 77.172; 580 580 580 5 86.429; 600 600 600 5 94.525; 620 620 620 5 105.401; 640 640 640 5 113.642; 660 660 660 5 126.331; 680 680 680 5 135.879; 700 700 700 5 151.19; 720 720 720 5 160.278; 740 740 740 5 177.538; 760 760 760 5 188.954; 780 780 780 5 207.189; 800 800 800 5 221.625; 820 820 820 5 241.557; 840 840 840 5 255.794; 860 860 860 5 277.18; 880 880 880 5 293.65; 900 900 900 5 319.089; 920 920 920 5 333.081; 940 940 940 5 362.84; 960 960 960 5 377.744; 980 980 980 5 411.486; 1000 1000 1000 5 428.95;...
 1020 1020 1020 5 464.756; 1040 1040 1040 5 495.338; 1060 1060 1060 5 520.008; 1080 1080 1080 5 539.999; 1100 1100 1100 5 580.207; 1120 1120 1120 5 601.182; 1140 1140 1140 5 648.288; 1160 1160 1160 5 670.222; 1180 1180 1180 5 717.212; 1200 1200 1200 5 737.86; 1220 1220 1220 5 791.453; 1240 1240 1240 5 815.44; 1260 1260 1260 5 883.154; 1280 1280 1280 5 898.4; 1300 1300 1300 5 957.717; 1320 1320 1320 5 983.866; 1340 1340 1340 5 1052.78; 1360 1360 1360 5 1073.18; 1380 1380 1380 5 1141.07; 1400 1400 1400 5 1169.93; 1420 1420 1420 5 1243.43; 1440 1440 1440 5 1270.68; 1460 1460 1460 5 1353.02; 1480 1480 1480 5 1378.73; 1500 1500 1500 5 1463.05; 1520 1520 1520 5 1492.76; 1540 1540 1540 5 1594.02; 1560 1560 1560 5 1668.29; 1580 1580 1580 5 1756.18; 1600 1600 1600 5 1781.53; 1620 1620 1620 5 1868.43; 1640 1640 1640 5 1903.83; 1660 1660 1660 5 1968.64; 1680 1680 1680 5 2054.76; 1700 1700 1700 5 2108.9; 1720 1720 1720 5 2144.67; 1740 1740 1740 5 2305.73; 1760 1760 1760 5 2290.39; 1780 1780 1780 5 2415.66; 1800 1800 1800 5 2459.12; 1820 1820 1820 5 2639.74; 1840 1840 1840 5 2618.34; 1860 1860 1860 5 2752.21; 1880 1880 1880 5 2799.03; 1900 1900 1900 5 2983.74; 1920 1920 1920 5 2971.21; 1940 1940 1940 5 3131.65; 1960 1960 1960 5 3161.95; 1980 1980 1980 5 3320.3; 2000 2000 2000 5 3359.69;...
 2020 2020 2020 5 3532.85; 2040 2040 2040 5 3574.56; 2060 2060 2060 5 3757.77; 2080 2080 2080 5 3885.4; 2100 2100 2100 5 3995.21; 2120 2120 2120 5 4011.28; 2140 2140 2140 5 4193.75; 2160 2160 2160 5 4236.83; 2180 2180 2180 5 4481.54; 2200 2200 2200 5 4510.52; 2220 2220 2220 5 4709.78; 2240 2240 2240 5 4692.45; 2260 2260 2260 5 5025.07; 2280 2280 2280 5 4951.92; 2300 2300 2300 5 5277.34; 2320 2320 2320 5 5224.82; 2340 2340 2340 5 5581.79; 2360 2360 2360 5 5493.9; 2380 2380 2380 5 5732.3; 2400 2400 2400 5 5797.17; 2420 2420 2420 5 6020.4; 2440 2440 2440 5 6101.32; 2460 2460 2460 5 6328.19; 2480 2480 2480 5 6372.47; 2500 2500 2500 5 6634.08;];

outer_seq = [40 10 40 5 0.059; 60 15 60 5 0.059; 80 20 80 5 0.106; 100 25 100 5 0.199; 120 30 120 5 0.283; 140 35 140 5 0.492; 160 40 160 5 0.623; 180 45 180 5 1.189; 200 50 200 5 1.116; 220 55 220 5 1.574; 240 60 240 5 1.875; 260 65 260 5 2.626; 280 70 280 5 2.84; 300 75 300 5 3.603; 320 80 320 5 4.16; 340 85 340 5 5.353; 360 90 360 5 5.748; 380 95 380 5 6.97; 400 100 400 5 7.815; 420 105 420 5 9.421; 440 110 440 5 10.16; 460 115 460 5 11.819; 480 120 480 5 12.872; 500 125 500 5 15.269; 520 130 520 5 16.318; 540 135 540 5 19.473; 560 140 560 5 20.65; 580 145 580 5 23.793; 600 150 600 5 25.208; 620 155 620 5 28.822; 640 160 640 5 30.225; 660 165 660 5 33.658; 680 170 680 5 35.179; 700 175 700 5 39.188; 720 180 720 5 42.289; 740 185 740 5 46.533; 760 190 760 5 48.824; 780 195 780 5 53.781; 800 200 800 5 57.074; 820 205 820 5 62.638; 840 210 840 5 65.71; 860 215 860 5 71.417; 880 220 880 5 75.165; 900 225 900 5 82.125; 920 230 920 5 85.493; 940 235 940 5 92.579; 960 240 960 5 96.623; 980 245 980 5 105.196; 1000 250 1000 5 109.894;...
 1020 255 1020 5 117.313; 1040 260 1040 5 126.554; 1060 265 1060 5 135.915; 1080 270 1080 5 137.479; 1100 275 1100 5 150.029; 1120 280 1120 5 152.599; 1140 285 1140 5 169.958; 1160 290 1160 5 169.092; 1180 295 1180 5 186.717; 1200 300 1200 5 186.609; 1220 305 1220 5 205.463; 1240 310 1240 5 208.264; 1260 315 1260 5 233.383; 1280 320 1280 5 226.556; 1300 325 1300 5 247.013; 1320 330 1320 5 246.922; 1340 335 1340 5 272.299; 1360 340 1360 5 270.34; 1380 345 1380 5 297.424; 1400 350 1400 5 295.42; 1420 355 1420 5 322.256; 1440 360 1440 5 320.771; 1460 365 1460 5 349.429; 1480 370 1480 5 347.348; 1500 375 1500 5 377.051; 1520 380 1520 5 379.547; 1540 385 1540 5 415.071; 1560 390 1560 5 424.993; 1580 395 1580 5 442.692; 1600 400 1600 5 452.849; 1620 405 1620 5 478.848; 1640 410 1640 5 487.638; 1660 415 1660 5 512.345; 1680 420 1680 5 527.773; 1700 425 1700 5 552.556; 1720 430 1720 5 549.184; 1740 435 1740 5 588.491; 1760 440 1760 5 586.258; 1780 445 1780 5 635.401; 1800 450 1800 5 628.137; 1820 455 1820 5 692.9; 1840 460 1840 5 689.107; 1860 465 1860 5 750.371; 1880 470 1880 5 718.801; 1900 475 1900 5 777.205; 1920 480 1920 5 759.757; 1940 485 1940 5 822.977; 1960 490 1960 5 809.845; 1980 495 1980 5 867.707; 2000 500 2000 5 859.262;...
 2020 505 2020 5 918.768; 2040 510 2040 5 914.727; 2060 515 2060 5 984.385; 2080 520 2080 5 1007.03; 2100 525 2100 5 1028.45; 2120 530 2120 5 1035.01; 2140 535 2140 5 1084.64; 2160 540 2160 5 1090.72; 2180 545 2180 5 1158.91; 2200 550 2200 5 1150.83; 2220 555 2220 5 1214.41; 2240 560 2240 5 1206.29; 2260 565 2260 5 1310.55; 2280 570 2280 5 1274.86; 2300 575 2300 5 1367.46; 2320 580 2320 5 1372.52; 2340 585 2340 5 1465.38; 2360 590 2360 5 1408.69; 2380 595 2380 5 1473.02; 2400 600 2400 5 1475.68; 2420 605 2420 5 1547.58; 2440 610 2440 5 1564.55; 2460 615 2460 5 1620.79; 2480 620 2480 5 1629.69; 2500 625 2500 5 1703.72;];

shortfat_seq = [10 40 40 5 0.015; 15 60 60 5 0.107; 20 80 80 5 0.113; 25 100 100 5 0.196; 30 120 120 5 0.335; 35 140 140 5 0.488; 40 160 160 5 0.683; 45 180 180 5 0.944; 50 200 200 5 1.195; 55 220 220 5 1.688; 60 240 240 5 2.001; 65 260 260 5 2.424; 70 280 280 5 2.888; 75 300 300 5 3.699; 80 320 320 5 3.97; 85 340 340 5 5.148; 90 360 360 5 5.831; 95 380 380 5 7.019; 100 400 400 5 7.64; 105 420 420 5 9.245; 110 440 440 5 10.504; 115 460 460 5 11.855; 120 480 480 5 12.569; 125 500 500 5 14.951; 130 520 520 5 16.572; 135 540 540 5 19.196; 140 560 560 5 20.302; 145 580 580 5 23.064; 150 600 600 5 24.953; 155 620 620 5 28.142; 160 640 640 5 28.746; 165 660 660 5 33.512; 170 680 680 5 35.871; 175 700 700 5 40.301; 180 720 720 5 42.03; 185 740 740 5 46.109; 190 760 760 5 49.538; 195 780 780 5 54.684; 200 800 800 5 55.571; 205 820 820 5 63.542; 210 840 840 5 66.506; 215 860 860 5 72.929; 220 880 880 5 74.976; 225 900 900 5 82.419; 230 920 920 5 87.212; 235 940 940 5 94.15; 240 960 960 5 94.915; 245 980 980 5 105.823; 250 1000 1000 5 110.331;...
 255 1020 1020 5 120.961; 260 1040 1040 5 123.274; 265 1060 1060 5 134.273; 270 1080 1080 5 139.388; 275 1100 1100 5 149.308; 280 1120 1120 5 149.861; 285 1140 1140 5 165.057; 290 1160 1160 5 172.672; 295 1180 1180 5 184.712; 300 1200 1200 5 187.666; 305 1220 1220 5 201.795; 310 1240 1240 5 209.182; 315 1260 1260 5 222.315; 320 1280 1280 5 222.908; 325 1300 1300 5 244.723; 330 1320 1320 5 252.247; 335 1340 1340 5 268.82; 340 1360 1360 5 273.451; 345 1380 1380 5 289.785; 350 1400 1400 5 301.76; 355 1420 1420 5 317.895; 360 1440 1440 5 317.43; 365 1460 1460 5 345.419; 370 1480 1480 5 355.149; 375 1500 1500 5 374.82; 380 1520 1520 5 380.588; 385 1540 1540 5 407.101; 390 1560 1560 5 417.929; 395 1580 1580 5 438.146; 400 1600 1600 5 436.513; 405 1620 1620 5 470.577; 410 1640 1640 5 485.308; 415 1660 1660 5 508.496; 420 1680 1680 5 515.277; 425 1700 1700 5 544.573; 430 1720 1720 5 561.294; 435 1740 1740 5 584.41; 440 1760 1760 5 580.489; 445 1780 1780 5 624.522; 450 1800 1800 5 641.033; 455 1820 1820 5 671.665; 460 1840 1840 5 677.798; 465 1860 1860 5 711.725; 470 1880 1880 5 730.442; 475 1900 1900 5 761.14; 480 1920 1920 5 756.338; 485 1940 1940 5 808.978; 490 1960 1960 5 825.532; 495 1980 1980 5 861.732; 500 2000 2000 5 868.495;...
 505 2020 2020 5 914.815; 510 2040 2040 5 936.54; 515 2060 2060 5 993.003; 520 2080 2080 5 959.562; 525 2100 2100 5 1025.7; 530 2120 2120 5 1041.53; 535 2140 2140 5 1085.83; 540 2160 2160 5 1091.15; 545 2180 2180 5 1151.33; 550 2200 2200 5 1166.34; 555 2220 2220 5 1211.09; 560 2240 2240 5 1193.82; 565 2260 2260 5 1275.38; 570 2280 2280 5 1509.35; 575 2300 2300 5 1584.1; 580 2320 2320 5 1479.44; 585 2340 2340 5 1495.22; 590 2360 2360 5 1540.97; 595 2380 2380 5 1567.93; 600 2400 2400 5 1465.73; 605 2420 2420 5 1553.07; 610 2440 2440 5 1578.1; 615 2460 2460 5 1638.67; 620 2480 2480 5 1640.37; 625 2500 2500 5 1707.11;];
 
% using 5 trials
gflops_perf = @(X) 1e3 * 2 * X(:, 4) .* X(:, 1) .* X(:, 3) .* (X(:, 2) - 1) ./ X(:, 5) / 1e9;
dims = @(X) X(:, 3);

close all

lw = 2.5;        % LineWidth
msz = 2;       % MarkerSize
make_plot_pre(6, 4);
plot(dims(shortfat_seq), gflops_perf(shortfat_seq), 'g>--', ...
    dims(outer_seq),    gflops_perf(outer_seq), 'ro--', ...
    dims(square_seq),   gflops_perf(square_seq), 'b-', ...
     'LineWidth', lw, 'MarkerSize', msz);
xlabel('Large matrix dimension (N)');
ylabel('GFLOPS');
title('Sequential performance of MKL DGEMM');
legend('inner-square', 'outer product', 'square', 'Location', 'SouthEast')
make_plot_post(6, 4);
print('fast-matmul_paper_figs/dgemm_curves_seq','-depsc','-r300');

%%%%%%%%%%%%
    
num_cores = 24;
gflops_perf_par = @(X) 1e3 * 2 * X(:, 4) .* X(:, 1) .* X(:, 3) .* (X(:, 2) - 1) ./ X(:, 5) / 1e9 / num_cores;

square_par = [ 200 200 200 5 40.609; 300 300 300 5 2.295; 400 400 400 5 4.444; 500 500 500 5 8.418; 600 600 600 5 12.96; 700 700 700 5 20.404; 800 800 800 5 25.912; 900 900 900 5 36.405; 1000 1000 1000 5 45.518;...
 1100 1100 1100 5 61.351; 1200 1200 1200 5 80.672; 1300 1300 1300 5 133.689; 1400 1400 1400 5 123.566; 1500 1500 1500 5 150.537; 1600 1600 1600 5 181.69; 1700 1700 1700 5 215.778; 1800 1800 1800 5 253.855; 1900 1900 1900 5 301.998; 2000 2000 2000 5 352.965;...
 2100 2100 2100 5 407.906; 2200 2200 2200 5 459.427; 2300 2300 2300 5 518.128; 2400 2400 2400 5 602.833; 2500 2500 2500 5 678.984; 2600 2600 2600 5 759.06; 2700 2700 2700 5 849.215; 2800 2800 2800 5 945.359; 2900 2900 2900 5 1054.06; 3000 3000 3000 5 1156.03;...
 3100 3100 3100 5 1298.33; 3200 3200 3200 5 1405.83; 3300 3300 3300 5 1534.33; 3400 3400 3400 5 1672.14; 3500 3500 3500 5 1819.75; 3600 3600 3600 5 2012.78; 3700 3700 3700 5 1216.68; 3800 3800 3800 5 1202.48; 3900 3900 3900 5 1303.76; 4000 4000 4000 5 1376.91;...
 4100 4100 4100 5 1583.44; 4200 4200 4200 5 1616.03; 4300 4300 4300 5 1750.16; 4400 4400 4400 5 1861.79; 4500 4500 4500 5 2000.33; 4600 4600 4600 5 2172.89; 4700 4700 4700 5 2363.57; 4800 4800 4800 5 2326.08; 4900 4900 4900 5 2525.96; 5000 5000 5000 5 2638.84;...
 5100 5100 5100 5 2856.15; 5200 5200 5200 5 3046.24; 5300 5300 5300 5 3169.89; 5400 5400 5400 5 3328.5; 5500 5500 5500 5 3566.39; 5600 5600 5600 5 3693.1; 5700 5700 5700 5 4257.7; 5800 5800 5800 5 4130.81; 5900 5900 5900 5 4472.19; 6000 6000 6000 5 4504.22;...
 6100 6100 6100 5 4836.73; 6200 6200 6200 5 5077.68; 6300 6300 6300 5 5444.14; 6400 6400 6400 5 5577.6; 6500 6500 6500 5 5778.65; 6600 6600 6600 5 5959.06; 6700 6700 6700 5 6388.6; 6800 6800 6800 5 6535.74; 6900 6900 6900 5 7223.55; 7000 7000 7000 5 7163.64;...
 7100 7100 7100 5 7629.54; 7200 7200 7200 5 7693.9; 7300 7300 7300 5 8217.5; 7400 7400 7400 5 8846.08; 7500 7500 7500 5 8820.49; 7600 7600 7600 5 9165.38; 7700 7700 7700 5 9602.38; 7800 7800 7800 5 10368.2; 7900 7900 7900 5 10374.7; 8000 8000 8000 5 10675.4;...
 8100 8100 8100 5 11439; 8200 8200 8200 5 12325.6; 8300 8300 8300 5 12237.9; 8400 8400 8400 5 12918.1; 8500 8500 8500 5 12875.8; 8600 8600 8600 5 13132.7; 8700 8700 8700 5 14043.5; 8800 8800 8800 5 14091.1; 8900 8900 8900 5 15110.1; 9000 9000 9000 5 17565.6;];

 outer_par = [200 50 200 5 48.452; 300 75 300 5 1.307; 400 100 400 5 1.919; 500 125 500 5 3.348; 600 150 600 5 3.989; 700 175 700 5 5.357; 800 200 800 5 7.716; 900 225 900 5 10.585; 1000 250 1000 5 14.929;...
 1100 275 1100 5 20.441; 1200 300 1200 5 21.221; 1300 325 1300 5 309.783; 1400 350 1400 5 17.662; 1500 375 1500 5 23.144; 1600 400 1600 5 27.305; 1700 425 1700 5 33.258; 1800 450 1800 5 37.56; 1900 475 1900 5 47.813; 2000 500 2000 5 53.285;...
 2100 525 2100 5 64.133; 2200 550 2200 5 71.285; 2300 575 2300 5 82.968; 2400 600 2400 5 83.954; 2500 625 2500 5 96.804; 2600 650 2600 5 106.562; 2700 675 2700 5 120.021; 2800 700 2800 5 130.563; 2900 725 2900 5 147.718; 3000 750 3000 5 162.631;...
 3100 775 3100 5 189.815; 3200 800 3200 5 204.308; 3300 825 3300 5 217.394; 3400 850 3400 5 234.31; 3500 875 3500 5 258.645; 3600 900 3600 5 267.986; 3700 925 3700 5 293.877; 3800 950 3800 5 318.392; 3900 975 3900 5 344.162; 4000 1000 4000 5 361.289;...
 4100 1025 4100 5 428.305; 4200 1050 4200 5 434.26; 4300 1075 4300 5 460.506; 4400 1100 4400 5 481.128; 4500 1125 4500 5 521.194; 4600 1150 4600 5 563.963; 4700 1175 4700 5 592.263; 4800 1200 4800 5 606.196; 4900 1225 4900 5 652.144; 5000 1250 5000 5 685.245;...
 5100 1275 5100 5 741.587; 5200 1300 5200 5 809.455; 5300 1325 5300 5 827.371; 5400 1350 5400 5 857.877; 5500 1375 5500 5 1001.97; 5600 1400 5600 5 1036.3; 5700 1425 5700 5 1059.57; 5800 1450 5800 5 1060.41; 5900 1475 5900 5 1139.37; 6000 1500 6000 5 1156.98;...
 6100 1525 6100 5 1250.58; 6200 1550 6200 5 1339.23; 6300 1575 6300 5 1415.97; 6400 1600 6400 5 1427.87; 6500 1625 6500 5 1477.93; 6600 1650 6600 5 1551.5; 6700 1675 6700 5 1628; 6800 1700 6800 5 1667.87; 6900 1725 6900 5 1841.44; 7000 1750 7000 5 1831.93;...
 7100 1775 7100 5 1946.69; 7200 1800 7200 5 2027.09; 7300 1825 7300 5 2135.28; 7400 1850 7400 5 2237.27; 7500 1875 7500 5 2259.17; 7600 1900 7600 5 2423.7; 7700 1925 7700 5 2514.27; 7800 1950 7800 5 2609.78; 7900 1975 7900 5 2632.27; 8000 2000 8000 5 2696.08;...
 8100 2025 8100 5 2853.23; 8200 2050 8200 5 3188.22; 8300 2075 8300 5 3140.34; 8400 2100 8400 5 3280.91; 8500 2125 8500 5 3268.19; 8600 2150 8600 5 3312.05; 8700 2175 8700 5 3485.69; 8800 2200 8800 5 3704.52; 8900 2225 8900 5 3753.09; 9000 2250 9000 5 3782.34;];
 
shortfat_par =  [50 200 200 5 13.265; 75 300 300 5 1.191; 100 400 400 5 1.907; 125 500 500 5 3.566; 150 600 600 5 4.693; 175 700 700 5 6.493; 200 800 800 5 7.805; 225 900 900 5 10.32; 250 1000 1000 5 12.303;...
 275 1100 1100 5 16.45; 300 1200 1200 5 21.635; 325 1300 1300 5 28.182; 350 1400 1400 5 32.118; 375 1500 1500 5 27.144; 400 1600 1600 5 28.788; 425 1700 1700 5 34.419; 450 1800 1800 5 38.125; 475 1900 1900 5 50.678; 500 2000 2000 5 53.283;...
 525 2100 2100 5 62.726; 550 2200 2200 5 67.467; 575 2300 2300 5 89.093; 600 2400 2400 5 86.837; 625 2500 2500 5 100.679; 650 2600 2600 5 107.868; 675 2700 2700 5 119.982; 700 2800 2800 5 142.446; 725 2900 2900 5 157.347; 750 3000 3000 5 162.556;...
 775 3100 3100 5 177.521; 800 3200 3200 5 186.119; 825 3300 3300 5 224.387; 850 3400 3400 5 241.165; 875 3500 3500 5 265.755; 900 3600 3600 5 270.032; 925 3700 3700 5 330.859; 950 3800 3800 5 335.373; 975 3900 3900 5 360.706; 1000 4000 4000 5 365.198;...
 1025 4100 4100 5 443.08; 1050 4200 4200 5 536.155; 1075 4300 4300 5 534.423; 1100 4400 4400 5 587.483; 1125 4500 4500 5 616.902; 1150 4600 4600 5 665.498; 1175 4700 4700 5 662.351; 1200 4800 4800 5 643.026; 1225 4900 4900 5 729.423; 1250 5000 5000 5 735.393;...
 1275 5100 5100 5 826.443; 1300 5200 5200 5 992.835; 1325 5300 5300 5 934.266; 1350 5400 5400 5 925.322; 1375 5500 5500 5 1032.78; 1400 5600 5600 5 992.608; 1425 5700 5700 5 1225.99; 1450 5800 5800 5 1127.37; 1475 5900 5900 5 1294.06; 1500 6000 6000 5 1406.44;...
 1525 6100 6100 5 1605.34; 1550 6200 6200 5 1691.86; 1575 6300 6300 5 1575.68; 1600 6400 6400 5 1498.51; 1625 6500 6500 5 1692.17; 1650 6600 6600 5 1656.05; 1675 6700 6700 5 1860.77; 1700 6800 6800 5 1791.47; 1725 6900 6900 5 2052.41; 1750 7000 7000 5 1980.61;...
 1775 7100 7100 5 2227.98; 1800 7200 7200 5 2185.54; 1825 7300 7300 5 2206.05; 1850 7400 7400 5 2882.38; 1875 7500 7500 5 2786.58; 1900 7600 7600 5 2639.83; 1925 7700 7700 5 2612.19; 1950 7800 7800 5 2774.56; 1975 7900 7900 5 2781.6; 2000 8000 8000 5 2982.03;...
 2025 8100 8100 5 3078.57; 2050 8200 8200 5 3337.1; 2075 8300 8300 5 3212; 2100 8400 8400 5 3429.45; 2125 8500 8500 5 3483.4; 2150 8600 8600 5 3847.73; 2175 8700 8700 5 3708.51; 2200 8800 8800 5 3869.11; 2225 8900 8900 5 3935.67; 2250 9000 9000 5 4405.82;];


make_plot_pre(6, 4);
plot(dims(tssquare_par), gflops_perf_par(tssquare_par), 'g>--', ...
    dims(outer_par),    gflops_perf_par(outer_par), 'ro--', ...
    dims(square_par),   gflops_perf_par(square_par), 'b-', ...
     'LineWidth', lw, 'MarkerSize', msz);
xlabel('Large matrix dimension (N)');
ylabel('GFLOPS / core');
title('Parallel performance of MKL DGEMM (24 cores)');
legend('inner-square', 'outer product', 'square', 'Location', 'SouthEast');
make_plot_post(6, 4);
print('fast-matmul_paper_figs/dgemm_curves_par','-depsc','-r300');

%%%%%%%%%%%%%%%%%

square_par_nodynamic = [ 200 200 200 5 83.856; 300 300 300 5 2.576; 400 400 400 5 3.858; 500 500 500 5 6.476; 600 600 600 5 9.346; 700 700 700 5 14.572; 800 800 800 5 17.809; 900 900 900 5 25.07; 1000 1000 1000 5 34.653;...
 1100 1100 1100 5 40.94; 1200 1200 1200 5 57.026; 1300 1300 1300 5 1006.52; 1400 1400 1400 5 89.524; 1500 1500 1500 5 101.404; 1600 1600 1600 5 114.26; 1700 1700 1700 5 146.908; 1800 1800 1800 5 154.875; 1900 1900 1900 5 201.264; 2000 2000 2000 5 213.952;...
 2100 2100 2100 5 267.272; 2200 2200 2200 5 288.345; 2300 2300 2300 5 348.642; 2400 2400 2400 5 363.283; 2500 2500 2500 5 390.873; 2600 2600 2600 5 461.293; 2700 2700 2700 5 493.327; 2800 2800 2800 5 577.505; 2900 2900 2900 5 617.586; 3000 3000 3000 5 705.868;...
 3100 3100 3100 5 745.181; 3200 3200 3200 5 786.783; 3300 3300 3300 5 901.71; 3400 3400 3400 5 950.413; 3500 3500 3500 5 1088.1; 3600 3600 3600 5 1123.54; 3700 3700 3700 5 1305.39; 3800 3800 3800 5 1677.8; 3900 3900 3900 5 1511.34; 4000 4000 4000 5 1576.46;...
 4100 4100 4100 5 1682.06; 4200 4200 4200 5 1807.71; 4300 4300 4300 5 1879.98; 4400 4400 4400 5 2087.71; 4500 4500 4500 5 2436.51; 4600 4600 4600 5 2408.93; 4700 4700 4700 5 2503.46; 4800 4800 4800 5 2543.01; 4900 4900 4900 5 2837.83; 5000 5000 5000 5 2909.33;...
 5100 5100 5100 5 3509.46; 5200 5200 5200 5 3307.13; 5300 5300 5300 5 3614.71; 5400 5400 5400 5 3676.34; 5500 5500 5500 5 4124.24; 5600 5600 5600 5 4123.26; 5700 5700 5700 5 4280.6; 5800 5800 5800 5 4624.91; 5900 5900 5900 5 4823.93; 6000 6000 6000 5 5103.81;...
 6100 6100 6100 5 5273.38; 6200 6200 6200 5 5859.17; 6300 6300 6300 5 5843.72; 6400 6400 6400 5 6009.93; 6500 6500 6500 5 6454.27; 6600 6600 6600 5 6516.68; 6700 6700 6700 5 7023.11; 6800 6800 6800 5 7409.83; 6900 6900 6900 5 7744.83; 7000 7000 7000 5 7938.52;...
 7100 7100 7100 5 8511.45; 7200 7200 7200 5 8937.97; 7300 7300 7300 5 8949.69; 7400 7400 7400 5 9620.83; 7500 7500 7500 5 9749.57; 7600 7600 7600 5 10552.8; 7700 7700 7700 5 10675.7; 7800 7800 7800 5 11409.2; 7900 7900 7900 5 12096.4; 8000 8000 8000 5 11944.1;...
 8100 8100 8100 5 12561.6; 8200 8200 8200 5 13174; 8300 8300 8300 5 13957.9; 8400 8400 8400 5 13711.8; 8500 8500 8500 5 14717.7; 8600 8600 8600 5 14784.3; 8700 8700 8700 5 15812; 8800 8800 8800 5 16013.3; 8900 8900 8900 5 16519.1; 9000 9000 9000 5 17235.4;];

outer_par_nodynamic = [ 200 50 200 5 105.491; 300 75 300 5 1.711; 400 100 400 5 1.934; 500 125 500 5 3.04; 600 150 600 5 3.579; 700 175 700 5 4.824; 800 200 800 5 5.833; 900 225 900 5 7.749; 1000 250 1000 5 10.113;...
 1100 275 1100 5 11.868; 1200 300 1200 5 14.27; 1300 325 1300 5 978.263; 1400 350 1400 5 21.9; 1500 375 1500 5 27.755; 1600 400 1600 5 29.992; 1700 425 1700 5 40.445; 1800 450 1800 5 41.141; 1900 475 1900 5 56.353; 2000 500 2000 5 58.341;...
 2100 525 2100 5 75.867; 2200 550 2200 5 80.927; 2300 575 2300 5 96.871; 2400 600 2400 5 98.075; 2500 625 2500 5 105.694; 2600 650 2600 5 124.149; 2700 675 2700 5 131.949; 2800 700 2800 5 156.088; 2900 725 2900 5 167.397; 3000 750 3000 5 187.118;...
 3100 775 3100 5 206.131; 3200 800 3200 5 215.186; 3300 825 3300 5 242.971; 3400 850 3400 5 256.091; 3500 875 3500 5 291.84; 3600 900 3600 5 295.037; 3700 925 3700 5 334.087; 3800 950 3800 5 349.271; 3900 975 3900 5 393.457; 4000 1000 4000 5 411.319;...
 4100 1025 4100 5 452.835; 4200 1050 4200 5 480.722; 4300 1075 4300 5 494.18; 4400 1100 4400 5 543.328; 4500 1125 4500 5 570.017; 4600 1150 4600 5 625.367; 4700 1175 4700 5 648.939; 4800 1200 4800 5 663.535; 4900 1225 4900 5 727.486; 5000 1250 5000 5 756.317;...
 5100 1275 5100 5 832.731; 5200 1300 5200 5 874.051; 5300 1325 5300 5 941.795; 5400 1350 5400 5 1063.22; 5500 1375 5500 5 1155.25; 5600 1400 5600 5 1057.48; 5700 1425 5700 5 1100.99; 5800 1450 5800 5 1184.28; 5900 1475 5900 5 1229.61; 6000 1500 6000 5 1306.54;...
 6100 1525 6100 5 1348.4; 6200 1550 6200 5 1476.68; 6300 1575 6300 5 1509.54; 6400 1600 6400 5 1557.33; 6500 1625 6500 5 1655.7; 6600 1650 6600 5 1675.18; 6700 1675 6700 5 1802.54; 6800 1700 6800 5 1840.59; 6900 1725 6900 5 1982.3; 7000 1750 7000 5 2030.15;...
 7100 1775 7100 5 2180.43; 7200 1800 7200 5 2253.98; 7300 1825 7300 5 2286.26; 7400 1850 7400 5 2480.02; 7500 1875 7500 5 2549.7; 7600 1900 7600 5 2616.01; 7700 1925 7700 5 2681.77; 7800 1950 7800 5 2813.47; 7900 1975 7900 5 2907.04; 8000 2000 8000 5 3083.89;...
 8100 2025 8100 5 3151.79; 8200 2050 8200 5 3298.14; 8300 2075 8300 5 3474.15; 8400 2100 8400 5 3475.19; 8500 2125 8500 5 3640.63; 8600 2150 8600 5 3886.05; 8700 2175 8700 5 3940.04; 8800 2200 8800 5 4027.15; 8900 2225 8900 5 4140.57; 9000 2250 9000 5 4294.8;];

shortfat_par_nodynamic = [ 50 200 200 5 97.712; 75 300 300 5 1.433; 100 400 400 5 2.044; 125 500 500 5 3.266; 150 600 600 5 3.962; 175 700 700 5 5.355; 200 800 800 5 6.167; 225 900 900 5 7.795; 250 1000 1000 5 11.339;...
 275 1100 1100 5 14.522; 300 1200 1200 5 12.575; 325 1300 1300 5 16.665; 350 1400 1400 5 22.102; 375 1500 1500 5 26.612; 400 1600 1600 5 30.272; 425 1700 1700 5 36.175; 450 1800 1800 5 42.215; 475 1900 1900 5 54.201; 500 2000 2000 5 60.554;...
 525 2100 2100 5 70.597; 550 2200 2200 5 77.683; 575 2300 2300 5 98.459; 600 2400 2400 5 91.524; 625 2500 2500 5 102.968; 650 2600 2600 5 113.323; 675 2700 2700 5 127.256; 700 2800 2800 5 149.718; 725 2900 2900 5 164.374; 750 3000 3000 5 176.408;...
 775 3100 3100 5 195.836; 800 3200 3200 5 217.667; 825 3300 3300 5 255.68; 850 3400 3400 5 285.003; 875 3500 3500 5 299.062; 900 3600 3600 5 304.016; 925 3700 3700 5 337.743; 950 3800 3800 5 352.403; 975 3900 3900 5 378.427; 1000 4000 4000 5 400.054;...
 1025 4100 4100 5 453.762; 1050 4200 4200 5 531.369; 1075 4300 4300 5 608.412; 1100 4400 4400 5 557.387; 1125 4500 4500 5 667.185; 1150 4600 4600 5 752.477; 1175 4700 4700 5 709.798; 1200 4800 4800 5 830.247; 1225 4900 4900 5 748.765; 1250 5000 5000 5 849.686;...
 1275 5100 5100 5 980.939; 1300 5200 5200 5 1550.23; 1325 5300 5300 5 1054.06; 1350 5400 5400 5 978.824; 1375 5500 5500 5 1109.88; 1400 5600 5600 5 1227.68; 1425 5700 5700 5 1177.2; 1450 5800 5800 5 1319.71; 1475 5900 5900 5 1266.96; 1500 6000 6000 5 1381.95;...
 1525 6100 6100 5 1573.15; 1550 6200 6200 5 1469.59; 1575 6300 6300 5 1658.79; 1600 6400 6400 5 1569.67; 1625 6500 6500 5 1746.61; 1650 6600 6600 5 1920.76; 1675 6700 6700 5 1993.96; 1700 6800 6800 5 2014.03; 1725 6900 6900 5 2263.44; 1750 7000 7000 5 2135.15;...
 1775 7100 7100 5 2383.43; 1800 7200 7200 5 2559.84; 1825 7300 7300 5 2481.41; 1850 7400 7400 5 2760.17; 1875 7500 7500 5 2594.78; 1900 7600 7600 5 2880.17; 1925 7700 7700 5 2726.67; 1950 7800 7800 5 3076.02; 1975 7900 7900 5 3355.18; 2000 8000 8000 5 3094.76;...
 2025 8100 8100 5 3459.38; 2050 8200 8200 5 3282.01; 2075 8300 8300 5 3550.28; 2100 8400 8400 5 3907.4; 2125 8500 8500 5 3686.81; 2150 8600 8600 5 4148.65; 2175 8700 8700 5 4470.9; 2200 8800 8800 5 4416.68; 2225 8900 8900 5 5189.21; 2250 9000 9000 5 4302.91;];

make_plot_pre(6, 4);
plot(dims(shortfat_par), gflops_perf_par(shortfat_par_nodynamic), 'g>--', ...
    dims(outer_par),    gflops_perf_par(outer_par_nodynamic), 'ro--', ...
    dims(square_par),   gflops_perf_par(square_par_nodynamic), 'b-', ...
     'LineWidth', lw, 'MarkerSize', msz);
xlabel('Large matrix dimension (N)');
ylabel('GFLOPS / core');
title('Parallel performance of MKL DGEMM (24 cores)');
legend('inner-square', 'outer product', 'square', 'Location', 'SouthEast');
make_plot_post(6, 4);
print('fast-matmul_paper_figs/dgemm_curves_par_nodynamic','-depsc','-r300');
